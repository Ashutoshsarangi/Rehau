!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@ngx-translate/http-loader"),require("@ngx-translate/core"),require("simple-crypto-js"),require("ionic-cordova-oauth/dist/provider"),require("sha.js"),require("ionic-cordova-oauth"),require("backoff-rxjs"),require("rxjs/operators"),require("@auth0/angular-jwt"),require("@ngrx/store"),require("@angular/router"),require("@angular/animations"),require("q"),require("@angular/common/http"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("rehau-functional-core",["exports","@ngx-translate/http-loader","@ngx-translate/core","simple-crypto-js","ionic-cordova-oauth/dist/provider","sha.js","ionic-cordova-oauth","backoff-rxjs","rxjs/operators","@auth0/angular-jwt","@ngrx/store","@angular/router","@angular/animations","q","@angular/common/http","rxjs","@angular/core"],t):t(e["rehau-functional-core"]={},e.httpLoader,e["^12"][1][2],e.SimpleCrypto,e.provider,e.shajs,e[0][0][9],e["^6"][3][3],e.rxjs.operators,e.angularJwt,e["@ngrx/store"],e.ng.router,e.ng.animations,e.q,e.ng.common.http,e.rxjs,e.ng.core)}(this,function(e,t,r,n,i,o,a,s,c,l,u,h,p,d,g,f,v){"use strict";n=n&&n.hasOwnProperty("default")?n["default"]:n,o=o&&o.hasOwnProperty("default")?o["default"]:o;var y=u.createAction("[OnBoarding Step] Manage Next Step",u.props()),m=u.createAction("[OnBoarding Step] Manage Back Step",u.props()),S=(I.prototype.showSuccess=function(){this.onBoardingData$.subscribe(function(e){console.log("this is list of onBoardings from App.component --\x3e",e)}),this.store.dispatch(y({payload:{configPosition:6}}))},I.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],I.ctorParameters=function(){return[{type:u.Store}]},I.ngInjectableDef=v.defineInjectable({factory:function(){return new I(v.inject(u.Store))},token:I,providedIn:"root"}),I);function I(e){this.store=e,this.onBoardingData$=e.pipe(u.select("onBoardingData"))}function w(e){return function(){return e.initConfig()}}var b=function(e,t){return(b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function T(e,t){function r(){this.constructor=e}b(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var _=function(){return(_=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function E(e,a,s,c){return new(s=s||Promise)(function(t,r){function n(e){try{o(c.next(e))}catch(t){r(t)}}function i(e){try{o(c["throw"](e))}catch(t){r(t)}}function o(e){e.done?t(e.value):function r(t){return t instanceof s?t:new s(function(e){e(t)})}(e.value).then(n,i)}o((c=c.apply(e,a||[])).next())})}function X(n,i){var o,a,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function r(e){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,a&&(s=2&e[0]?a["return"]:e[0]?a["throw"]||((s=a["return"])&&s.call(a),0):a.next)&&!(s=s.call(a,e[1])).done)return s;switch(a=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return c.label++,{value:e[1],done:!1};case 5:c.label++,a=e[1],e=[0];continue;case 7:e=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){c=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){c.label=e[1];break}if(6===e[0]&&c.label<s[1]){c.label=s[1],s=e;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(e);break}s[2]&&c.ops.pop(),c.trys.pop();continue}e=i.call(n,c)}catch(t){e=[6,t],a=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}function G(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o["return"])&&r.call(o)}finally{if(i)throw i.error}}return a}function L(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(A(arguments[t]));return e}var R=(k.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,L(["✅ "],e))},k.prototype.log_e=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,L(["🚫❗️ "],e))},k.prototype.log_w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,L(["🔶 "],e))},k.prototype.log_d=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log.apply(console,L(["🔷 TODO: "],e))},k.decorators=[{type:v.Injectable}],k);function k(){}var O=(C.prototype.initConfig=function(){this.conFig=this.configuration,this.logService.log("Configuration data loaded1: ",this.conFig)},C.decorators=[{type:v.Injectable}],C.ctorParameters=function(){return[{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]},{type:R}]},C);function C(e,t){this.configuration=e,this.logService=t}function D(e){return new t.TranslateHttpLoader(e,"./assets/i18n/",".json")}function j(e){return function(){return e.initTranslation()}}var P=(x.decorators=[{type:v.NgModule,args:[{imports:[g.HttpClientModule,r.TranslateModule.forRoot({loader:{provide:r.TranslateLoader,useFactory:D,deps:[g.HttpClient]}})],exports:[r.TranslateModule]}]}],x);function x(){}var N=(M.prototype.initTranslation=function(){this.logService.log("I am Init Translator",this.configuration),this.configuration?(this.logService.log("I am in config",this.configuration),this.configuration.globalConfig.languages&&this.addLangs(this.splitLanguages(this.configuration.globalConfig.languages)),this.configuration.globalConfig.defaultLanguage&&this.setDefaultLang(this.configuration.globalConfig.defaultLanguage),this.configuration.globalConfig.currentLanguage&&(this.logService.log("Hey Its TRUE I need to be called"),this.use(this.configuration.globalConfig.currentLanguage))):this.logService.log("No configuration provided. This service has not default values. Set them before use.")},M.prototype.splitLanguages=function(e){var t=e.split("|");return t.filter(function(e){return 0<e.length})},M.prototype.currentLang=function(){return this.translateService.currentLang},M.prototype.currentLoader=function(){return this.translateService.currentLoader},M.prototype.onLangChange=function(){return this.translateService.onLangChange},M.prototype.onTranslationChange=function(){return this.translateService.onTranslationChange},M.prototype.onDefaultLangChange=function(){return this.translateService.onDefaultLangChange},M.prototype.setDefaultLang=function(e){this.translateService.setDefaultLang(e)},M.prototype.getDefaultLang=function(){return this.translateService.getDefaultLang()},M.prototype.use=function(e){return this.logService.log("The Use Function is called  ---\x3e ",e),this.translateService.use(e)},M.prototype.getTranslation=function(e){return this.translateService.getTranslation(e)},M.prototype.addLangs=function(e){this.translateService.addLangs(e)},M.prototype.getLangs=function(){return this.translateService.getLangs()},M.prototype.reloadLang=function(e){return this.translateService.reloadLang(e)},M.prototype.resetLang=function(e){this.translateService.resetLang(e)},M.prototype.getBrowserLang=function(){return this.translateService.getBrowserLang()},M.prototype.getBrowserCultureLang=function(){return this.getBrowserCultureLang()},M.prototype.get=function(e,t){return this.translateService.get(e,t)},M.prototype.instant=function(t){var r=this;return new f.Observable(function(e){console.log("Hello **********************"),e.next(r.translateService.instant(t))})},M.prototype.instantObject=function(t){var e,r,n=this;if(Array.isArray(t)){var i=[];try{for(var o=G(t),a=o.next();!a.done;a=o.next()){var s=a.value;i.push(this.mainInstant(s))}}catch(c){e={error:c}}finally{try{a&&!a.done&&(r=o["return"])&&r.call(o)}finally{if(e)throw e.error}}return new f.Observable(function(e){console.log("Hello ######################"),e.next(i)})}return new f.Observable(function(e){console.log("Hello $$$$$$$$$$$$$$$$$$$$$$"),e.next(n.mainInstant(t))})},M.prototype.mainInstant=function(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if("string"==typeof n&&0<n.length){var i=this.translateService.instant(n);t[r]=i}else t[r]=n}return t},M.decorators=[{type:v.Injectable}],M.ctorParameters=function(){return[{type:r.TranslateService},{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]},{type:R}]},M);function M(e,t,r){this.translateService=e,this.configuration=t,this.logService=r}var U=(V.forRoot=function(e){return{ngModule:V,providers:[{provide:"SERVICE_CONFIG",useValue:e},{provide:v.APP_INITIALIZER,useFactory:w,deps:[v.forwardRef(function(){return O})],multi:!0},{provide:v.APP_INITIALIZER,useFactory:j,deps:[v.forwardRef(function(){return N})],multi:!0},O]}},V.decorators=[{type:v.NgModule,args:[{declarations:[],imports:[],exports:[P]}]}],V);function V(){}var q={configPosition:0},H=u.createReducer(q,u.on(y,function(e,t){return{configPosition:t.payload.configPosition+1}}),u.on(m,function(e,t){return{configPosition:t.payload.configPosition-1}}));function F(e,t){return H(e,t)}var $=u.createAction("User info from CIDAAS",u.props()),B={userInfo:{}},z=u.createReducer(B,u.on($,function(e,t){var r=t.payload;return{userInfo:_({},r.userInfo)}}));function J(e,t){return z(e,t)}var Q=u.createAction("Show-Hide laoder",u.props()),W={showLoader:!1},Z=u.createReducer(W,u.on(Q,function(e){return _({},e)}));function K(e,t){return Z(e,t)}var Y={onBoardingData:F,cidaasData:J,loaderState:K},ee=(te.prototype.removeLocalData=function(e){localStorage.removeItem(e)},te.prototype.getLocalData=function(e){return!!localStorage.getItem(e)&&this.simpleCrypto.decrypt(localStorage.getItem(e),!0)},te.prototype.setLocalData=function(e,t){var r=this.simpleCrypto.encrypt(t);localStorage.setItem(e,r)},te.decorators=[{type:v.Injectable}],te.ctorParameters=function(){return[{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]}]},te);function te(e){this.configuration=e,this.simpleCrypto=new n(this.configuration.globalConfig.SECRET_KEY)}var re,ne=(T(ie,re=i.OAuthProvider),ie.base64URLEncode=function(e){return e.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")},ie.prototype.sha256=function(e){return o("sha256").update(e).digest()},ie.prototype.removeParam=function(e,t){var r=t.split("?")[0],n=[],i=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==i){for(var o=(n=i.split("&")).length-1;0<=o;--o)n[o].split("=")[0]===e&&n.splice(o,1);r=r+"?"+n.join("&")}return r},ie.prototype.addParam=function(e,t){return t+="&scope=",t+=""+this.options.appScope.join(" ")},ie.prototype.optionsToDialogUrl=function(e){var t=re.prototype.optionsToDialogUrl.call(this,e);return t=this.removeParam("scope",t),t=this.addParam("scope",t),e.authType&&(t+="&auth_type="+e.authType),e.nonce&&(t+="&nonce="+e.nonce),"plain"===e.code_challenge_method&&(t+="&code_challenge="+e.code_challenge+"&code_challenge_method="+e.code_challenge_method),"S256"===e.code_challenge_method&&(t+="&code_challenge="+ie.base64URLEncode(this.sha256(e.code_challenge))+"&code_challenge_method="+e.code_challenge_method),e.viewType&&(t+="&view_type="+e.viewType),console.log("Calling URL: "+t),t},ie.CLIENT_ID="9feab210-c025-406d-a10c-3d8323214491",ie.tokenEndpoint=(ie.baseURL="https://accounts.rehau.com")+"/token-srv/token",ie);function ie(e){void 0===e&&(e={});var t=re.call(this,e)||this;if(t.revokeUrl=ie.baseURL+"/authz-srv/revoke",t.authUrl=ie.baseURL+"/authz-srv/authz",t.defaults={responseType:"code"},!e.appScope||e.appScope.length<=0)throw new Error("A "+t.name+" app scope must exist");return t}var oe=(ae.prototype.getApi=function(e,t,r){var n=this;return void 0===t&&(t={}),void 0===r&&(r={}),0!==Object.keys(r).length?this.http.get(e,t).pipe(c.timeout(r.REQ_TIMEOUT),s.retryBackoff({initialInterval:r.INIT_INTERVAL,maxInterval:r.MAX_INTERVAL,maxRetries:r.MAX_RETRIES,shouldRetry:function(e){return n.logService.log_w("Aborted remote request"),!0},backoffDelay:function(e,t){return Math.pow(1.5,e)*t}})):this.http.get(e,t)},ae.prototype.postApi=function(e,t,r,n){return void 0===r&&(r={}),void 0===n&&(n={}),console.log(e,"url"),console.log(t,"requestBody"),console.log(r,"httpOptions"),0!==Object.keys(n).length?this.http.post(e,t,r).pipe(c.timeout(n.REQ_TIMEOUT),s.retryBackoff({initialInterval:n.INIT_INTERVAL,maxInterval:n.MAX_INTERVAL,maxRetries:n.MAX_RETRIES,shouldRetry:function(e){return console.log("Aborted remote request"),!0},backoffDelay:function(e,t){return Math.pow(1.5,e)*t}})):this.http.post(e,t,r)},ae.prototype.requestApi=function(e,t,r,n){return void 0===n&&(n={}),0!==Object.keys(n).length?this.http.request(e,t,r).pipe(c.timeout(n.REQ_TIMEOUT),s.retryBackoff({initialInterval:n.INIT_INTERVAL,maxInterval:n.MAX_INTERVAL,maxRetries:n.MAX_RETRIES,shouldRetry:function(e){return console.log("Aborted remote request"),!0},backoffDelay:function(e,t){return Math.pow(1.5,e)*t}})):this.http.post(e,t,r)},ae.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],ae.ctorParameters=function(){return[{type:g.HttpClient},{type:R},{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]}]},ae.ngInjectableDef=v.defineInjectable({factory:function(){return new ae(v.inject(g.HttpClient),v.inject(R),v.inject("SERVICE_CONFIG"))},token:ae,providedIn:"root"}),ae);function ae(e,t,r){this.http=e,this.logService=t,this.configuration=r,this.BASE_URL=this.configuration.globalConfig.BASE_URL}var se="USERDATA",ce=new f.Subject,le=(ue.prototype.dispatchUserData=function(e){this.store.dispatch($({payload:{userInfo:e}}))},ue.prototype.getUserData=function(){return E(this,void 0,void 0,function(){var t;return X(this,function(e){return this.userData$.subscribe(function(e){0<Object.keys(e.userInfo).length&&(t=e.userInfo)}),[2,t]})})},ue.prototype.dispatchLoaderState=function(e){this.logService.log("in dispatch method tab loader state",e),this.store.dispatch(Q(e)),ce.next(e)},ue.prototype.getLoaderState=function(){return E(this,void 0,void 0,function(){var t;return X(this,function(e){return this.showLoader$.subscribe(function(e){t=e}),this.logService.log("in get loader state ---\x3e",t),ce.next(t.showLoader),[2,t.showLoader]})})},ue.decorators=[{type:v.Injectable}],ue.ctorParameters=function(){return[{type:u.Store},{type:R}]},ue);function ue(e,t){this.store=e,this.logService=t,this.userData$=this.store.pipe(u.select("cidaasData")),this.showLoader$=e.pipe(u.select("loaderState"))}var he=(pe.prototype.oAuthCallback=function(t,r){return E(this,void 0,void 0,function(){return X(this,function(e){switch(e.label){case 0:return[4,this.getToken(t,r)];case 1:return[2,e.sent()]}})})},pe.prototype.tokenRequest=function(t){return E(this,void 0,void 0,function(){return X(this,function(e){return[2,this.webService.postApi(this.configuration.cidaasConfig.ciddasTokenEndpoint,t).toPromise()]})})},pe.prototype.getToken=function(n,i){return E(this,void 0,void 0,function(){var t,r;return X(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.tokenRequest(n)];case 1:return(t=e.sent()).access_token&&t.refresh_token?(n.access_token=t.access_token,n.refresh_token=t.refresh_token,this.storeService.dispatchUserData(n),this.cacheService.setLocalData(se,n),[2,n]):(this.storeService.dispatchUserData({}),this.cacheService.removeLocalData(se),[2,t]);case 2:return(r=e.sent()).error instanceof ErrorEvent||0===r.status||408===r.status?(this.logservice.log_e("An error occurred for getting "+i+":",r.error.message),this.logservice.log("Never the less leave the use do its thing without tokens"),n.status=r.status,n.message=r.error.message):(this.logservice.log_e("Backend returned code for getting "+i+" "+r.status+", body was for getting "+i+" : "+r.error),this.storeService.dispatchUserData({}),this.cacheService.removeLocalData(se)),[2,n];case 3:return[2]}})})},pe.prototype.isLoggedIn=function(){return E(this,void 0,void 0,function(){var t,r;return X(this,function(e){switch(e.label){case 0:return[4,this.storeService.getUserData()];case 1:return t=e.sent(),r=this.cacheService.getLocalData(se),this.logservice.log("User data from local storage = ",r),this.logservice.log("User data from store = ",t),t&&r?[4,this.checkTokenStatus(r)]:[3,3];case 2:return[2,e.sent()];case 3:return!t||r?[3,5]:(this.cacheService.setLocalData(se,t),[4,this.checkTokenStatus(t)]);case 4:return[2,e.sent()];case 5:return t||!r?[3,7]:(this.storeService.dispatchUserData(r),[4,this.checkTokenStatus(r)]);case 6:return[2,e.sent()];case 7:return[2,!1]}})})},pe.prototype.checkTokenStatus=function(t){return E(this,void 0,void 0,function(){return X(this,function(e){switch(e.label){case 0:return this.isTokenExpire(t.access_token)?(this.logservice.log_w("THIS ACCESS_TOKEN IS EXPIRED in Login, try getting new one."),[4,this.refreshTokenWrapper(t)]):[3,2];case 1:return[2,e.sent()];case 2:return[2,!0]}})})},pe.prototype.isTokenExpire=function(e){return(new l.JwtHelperService).isTokenExpired(e)},pe.prototype.refreshTokenWrapper=function(r){return E(this,void 0,void 0,function(){var t;return X(this,function(e){switch(e.label){case 0:return t={client_id:this.configuration.cidaasConfig.cidaasClientId,grant_type:"refresh_token",refresh_token:r.refresh_token},[4,this.getToken(t,"refresh token")];case 1:return[2,e.sent()]}})})},pe.prototype.getCorrelationId=function(){return E(this,void 0,void 0,function(){var t;return X(this,function(e){switch(e.label){case 0:return[4,this.getUser()];case 1:return t=e.sent(),[2,(new l.JwtHelperService).decodeToken(t.access_token).sub]}})})},pe.prototype.getUser=function(){return E(this,void 0,void 0,function(){var t;return X(this,function(e){switch(e.label){case 0:return t=this.cacheService.getLocalData(se),new l.JwtHelperService,t&&this.isTokenExpire(t.access_token)?(this.logservice.log("THIS ACCESS_TOKEN IS EXPIRED in getUser, try getting new one."),[4,this.refreshTokenWrapper(t)]):[3,2];case 1:t=e.sent(),this.logservice.log("refreshTest::got result in getUser "+t),e.label=2;case 2:return[2,t]}})})},pe.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],pe.ctorParameters=function(){return[{type:oe},{type:ee},{type:R},{type:le},{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]}]},pe.ngInjectableDef=v.defineInjectable({factory:function(){return new pe(v.inject(oe),v.inject(ee),v.inject(R),v.inject(le),v.inject("SERVICE_CONFIG"))},token:pe,providedIn:"root"}),pe);function pe(e,t,r,n,i){this.webService=e,this.cacheService=t,this.logservice=r,this.storeService=n,this.configuration=i}var de="authorization_code",ge={closebuttoncolor:"#dd0060",hardwareback:"no",hidenavigationbuttons:"no",hideurlbar:"yes",navigationbuttoncolor:"#dd0060",toolbarcolor:"#f7f7f7"},fe={closebuttoncolor:"#dd0060",hardwareback:"no",hidenavigationbuttons:"no",hideurlbar:"yes",navigationbuttoncolor:"#dd0060",toolbarcolor:"#f7f7f7"},ve={message:"",status:"",accessToken:"",refreshToken:""},ye=(me.prototype.cidaasAuth=function(a,s){return void 0===s&&(s="browser"),E(this,void 0,void 0,function(){var t,r,n,i,o;return X(this,function(e){switch(e.label){case 0:"register token"===(a=a.trim())?t=new ne(_({},this.cidaasParam,this.cidaasRegisterProvider)):"login token"===a&&(t=new ne(_({},this.cidaasParam,this.cidaasLoginProvider))),r={grant_type:de,client_id:t.options.clientId,redirect_uri:t.options.redirectUri,code_verifier:ne.base64URLEncode(t.options.code_challenge)},this.logService.log("TEST CONFI SERVICE = ",+this.configService.configuration),this.logService.log("pkceBody required for login = "+r),this.logService.log("provider body required for login ="+t),i=ve,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.login(t,r,a,s)];case 2:return""===(n=e.sent()).access_token||n.access_token===undefined?(this.logService.log_e("login failed == "),this.logService.log_e(n),i.message="login Failed",i.status="1"):(this.logService.log("login successFull == "),this.logService.log(n),i.message="login success",i.status="0",i.accessToken=n.access_token,i.refreshToken=n.refresh_token),[2,i];case 3:return o=e.sent(),f.throwError(o),[3,4];case 4:return[2]}})})},me.prototype.cidaasLogout=function(){return E(this,void 0,void 0,function(){return X(this,function(e){try{return this.storeService.dispatchUserData({}),this.cacheService.removeLocalData(se),[2,!0]}catch(t){f.throwError(t)}return[2]})})},me.prototype.login=function(r,n,i,o){return E(this,void 0,void 0,function(){var t;return X(this,function(e){switch(e.label){case 0:return this.oauth="browser"===o?new a.OauthBrowser:new a.OauthCordova,this.cidaasLoginDesign!==undefined&&0!==Object.keys(this.cidaasLoginDesign).length||(this.cidaasLoginDesign=ge),this.cidaasRegisterDesign!==undefined&&0!==Object.keys(this.cidaasRegisterDesign).length||(this.cidaasRegisterDesign=fe),"register token"!==i?[3,2]:[4,this.oauth.logInVia(r,this.cidaasLoginDesign)];case 1:return t=e.sent(),[3,4];case 2:return"login token"!==i?[3,4]:[4,this.oauth.logInVia(r,this.cidaasRegisterDesign)];case 3:t=e.sent(),e.label=4;case 4:return t?(n.code=t.code,[4,this.authService.oAuthCallback(n,i)]):[3,6];case 5:return[2,e.sent()];case 6:return[2]}})})},me.decorators=[{type:v.Injectable}],me.ctorParameters=function(){return[{type:he},{type:R},{type:O},{type:le},{type:ee},{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]}]},me);function me(e,t,r,n,i,o){this.authService=e,this.logService=t,this.configService=r,this.storeService=n,this.cacheService=i,this.configuration=o,this.cidaasParam={clientId:this.configuration.cidaasConfig.cidaasClientId},this.cidaasRegisterProvider=this.configuration.cidaasConfig.cidaasRegisterProvider,this.cidaasLoginProvider=this.configuration.cidaasConfig.cidaasLoginProvider,this.cidaasLoginDesign=this.configuration.cidaasConfig.cidaasLoginDesign,this.cidaasRegisterDesign=this.configuration.cidaasConfig.cidaasRegisterDesign}var Se=(Ie.prototype.canActivate=function(){var t=this;this.logService.log("can Activate method is called!!!");var r=this.configuration.globalConfig.loginScreenUrl;try{return this.authService.isLoggedIn().then(function(e){return t.logService.log("User exist or not",e),e?(t.logService.log("Already logged in user!!!"),!0):(t.logService.log_w("Please do login to continue......"),t.router.navigate(["/"+r]),!1)})}catch(e){return this.logService.log_e("Error occured in isLoggedIn method"),!1}},Ie.decorators=[{type:v.Injectable}],Ie.ctorParameters=function(){return[{type:R},{type:he},{type:h.Router},{type:undefined,decorators:[{type:v.Inject,args:["SERVICE_CONFIG"]}]}]},Ie);function Ie(e,t,r,n){this.logService=e,this.authService=t,this.router=r,this.configuration=n}var we=p.trigger("routeAnimations",[p.transition("TabLevel => SecondLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(-100%)"}))],{optional:!0})])]),p.transition("ThirdLevel => ForthLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(-100%)"}))],{optional:!0})])]),p.transition("SecondLevel => ThirdLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(-100%)"}))],{optional:!0})])]),p.transition("SecondLevel => TabLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(-100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(100%)"}))],{optional:!0})])]),p.transition("ForthLevel => ThirdLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(-100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(100%)"}))],{optional:!0})])]),p.transition("ThirdLevel => SecondLevel",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%",height:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(-100%)"}),p.animate("0.15s linear",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate("0.15s linear",p.style({transform:"translateX(100%)"}))],{optional:!0})])]),p.transition(":decrement",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(-100%)"}),p.animate(".3s ease-out",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate(".3s ease-out",p.style({transform:"translateX(100%)"}))],{optional:!0})])]),p.transition(":increment",[p.query(":enter, :leave",p.style({position:"fixed",width:"100%"}),{optional:!0}),p.group([p.query(":enter",[p.style({transform:"translateX(100%)"}),p.animate(".3s ease-out",p.style({transform:"translateX(0%)"}))],{optional:!0}),p.query(":leave",[p.style({transform:"translateX(0%)"}),p.animate(".3s ease-out",p.style({transform:"translateX(-100%)"}))],{optional:!0})])])]),be=(Te.prototype.nextClickActionHandler=function(t,r,n){return E(this,void 0,void 0,function(){return X(this,function(e){switch(e.label){case 0:return this.logService.log("currentPageTitile --\x3e",t),this.logService.log("nextPageTitle --\x3e",r),this.logService.log("prevPageTitle --\x3e",n),[4,d.delay(5e3)];case 1:return e.sent(),[2,"success"]}})})},Te.prototype.prevClickActionHandler=function(t,r,n){return E(this,void 0,void 0,function(){return X(this,function(e){switch(e.label){case 0:return this.logService.log("currentPageTitile --\x3e",t),this.logService.log("nextPageTitle --\x3e",r),this.logService.log("prevPageTitle --\x3e",n),[4,d.delay(5e3)];case 1:return e.sent(),[2,"success"]}})})},Te.decorators=[{type:v.Injectable}],Te.ctorParameters=function(){return[{type:R}]},Te);function Te(e){this.logService=e}var _e=1043,Ee=1,Ae=1,Le="admin",Re="local",ke="remote",Oe="https://fieldtest.smarthome-dev.aws.rehau.com/deviceControl/api/v1",Ce="https://fieldtest.smarthome-dev.aws.rehau.com/acl/api/v1",De="admin",je="local",Pe="remote",xe=(Ne.prototype.cloudGetHomes=function(u){return E(this,void 0,void 0,function(){var r,n,i,o,a,s,c,l;return X(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.userControllerGET(u)];case 1:i=e.sent(),o=[];try{for(a=G(Object.keys(i.homes)),s=a.next();!s.done;s=a.next())c=s.value,o.push(i.homes[c])}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a["return"])&&n.call(a)}finally{if(r)throw r.error}}return[2,{homes:o,response:i}];case 2:return l=e.sent(),console.error("gatewayAclServer::cloudGetHomes: Could not fetch Homes "+JSON.stringify(l)),[2,{homes:[],response:null}];case 3:return[2]}})})},Ne.prototype.userControllerGET=function(s){return E(this,void 0,void 0,function(){var t,r,n,i,o,a;return X(this,function(e){switch(e.label){case 0:return t={},r=g.HttpHeaders.bind,n={"Content-Type":"application/json",access_token:s},i="x-correlation-id",[4,this.authService.getCorrelationId()];case 1:return t.headers=new(r.apply(g.HttpHeaders,[void 0,(n[i]=e.sent(),n)])),o={REQ_TIMEOUT:Ne.REQ_TIMEOUT,INIT_INTERVAL:Ne.INIT_INTERVAL,MAX_INTERVAL:Ne.MAX_INTERVAL,MAX_RETRIES:Ne.MAX_RETRIES},[4,this.webService.getApi("https://fieldtest.smarthome-dev.aws.rehau.com/acl/api/v1/users/",t,o).toPromise()];case 2:return a=e.sent(),this.logService.log(a),[2,a]}})})},Ne.prototype.getGatewaysToHome=function(e,y,m){return E(this,void 0,void 0,function(){var n,i,o,a,s,c,l,u,h,p,d,g,f,v;return X(this,function(e){s=[];try{for(c=G(Object.keys(m.homes[y].gateways)),l=c.next();!l.done;l=c.next()){u=l.value,h={credentials:[]};try{for(p=G(Object.keys(m.homes[y].gateways[u].userCredentials)),d=p.next();!d.done;d=p.next())g=d.value,h.homeGwId=u,console.log("Getting credId: "+g),f=m.homes[y].gateways[u].userCredentials[g],console.log("Getting homeId: "+y),console.log(f),f.type!==De&&f.type!==je&&f.type!==Pe||(v={user:f.user,password:f.password,type:"admin"===f.type?Le:"local"===f.type?Re:"remote"===f.type?ke:null},console.log("Got correct type! "+JSON.stringify(v)),h.credentials.push(v))}catch(t){o={error:t}}finally{try{d&&!d.done&&(a=p["return"])&&a.call(p)}finally{if(o)throw o.error}}s.push(h)}}catch(r){n={error:r}}finally{try{l&&!l.done&&(i=c["return"])&&i.call(c)}finally{if(n)throw n.error}}return[2,s]})})},Ne.prototype.getHomeOfUser=function(c,l){return E(this,void 0,void 0,function(){var t,r,n,i,o,a,s;return X(this,function(e){switch(e.label){case 0:return console.log("GatewayACLService::getHomeOfUser: "+c+" for HomeID "+l),t={},r=g.HttpHeaders.bind,n={"Content-Type":"application/json",access_token:c},i="x-correlation-id",[4,this.authService.getCorrelationId()];case 1:return t.headers=new(r.apply(g.HttpHeaders,[void 0,(n[i]=e.sent(),n)])),o=Ce+"/users/homes/"+l,a={REQ_TIMEOUT:Ne.REQ_TIMEOUT,INIT_INTERVAL:Ne.INIT_INTERVAL,MAX_INTERVAL:Ne.MAX_INTERVAL,MAX_RETRIES:Ne.MAX_RETRIES},[4,this.webService.getApi(o,t,a).toPromise()];case 2:return s=e.sent(),this.logService.log(s),[2,s]}})})},Ne.INIT_INTERVAL=2e3,Ne.MAX_INTERVAL=6e3,Ne.MAX_RETRIES=3,Ne.REQ_TIMEOUT=8e3,Ne.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],Ne.ctorParameters=function(){return[{type:g.HttpClient},{type:he},{type:oe},{type:R}]},Ne.ngInjectableDef=v.defineInjectable({factory:function(){return new Ne(v.inject(g.HttpClient),v.inject(he),v.inject(oe),v.inject(R))},token:Ne,providedIn:"root"}),Ne);function Ne(e,t,r,n){this.httpClient=e,this.authService=t,this.webService=r,this.logService=n,this.storageName="gateway_device"}var Me,Ue=(T(Ve,Me=Error),Ve);function Ve(e){var t=Me.call(this,e)||this;return Object.setPrototypeOf(t,Ve.prototype),t}var qe,Xe=(T(Ge,qe=Error),Ge);function Ge(e){var t=qe.call(this,e)||this;return t.name="GatewaySerialNotFoundError",Object.setPrototypeOf(t,Ue.prototype),t}var He=(Fe.prototype.callApi=function(j,P,x,N,M,U,V,e,t,q){return void 0===x&&(x="get"),void 0===N&&(N=null),void 0===V&&(V=2),void 0===e&&(e=3),void 0===t&&(t={"continue":!0}),void 0===q&&(q="json"),E(this,void 0,void 0,function(){var r,n,i,o,a,s,c,l,u,h,p,d,g,f,v,y,m,S,I,w,b,T,_,E,A,L,R,k,O,C,D;return X(this,function(e){switch(e.label){case 0:i={REQ_TIMEOUT:Fe.REQ_TIMEOUT_LOCAL,INIT_INTERVAL:Fe.INIT_INTERVAL_LOCAL,MAX_INTERVAL:Fe.MAX_INTERVAL_LOCAL,MAX_RETRIES:V},!U&&this.completedFirstRun&&(U=this.localOnline?"local":this.remoteOnline?"remote":undefined),s="local"===U?Re:ke;try{for(c=G(j.credentials),l=c.next();!l.done;l=c.next())(u=l.value).type===s&&(o=u.user,a=u.password)}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=c["return"])&&n.call(c)}finally{if(r)throw r.error}}if(o===undefined||a===undefined)throw new Error("Username or Password undefined");return"remote"!==U?[3,10]:(this.logService.log("Connection is remote"),h={boxId:j.boxId,username:o,password:a,urlEndpoint:P,method:x,body:undefined},"POST"!==x.toUpperCase()&&"PUT"!==x.toUpperCase()&&"PATCH"!==x.toUpperCase()||(h.body=JSON.stringify(N)),[4,this.authService.getUser()]);case 1:p=e.sent(),d={access_token:p.access_token},e.label=2;case 2:return e.trys.push([2,4,,5]),g=d,f="x-correlation-id",[4,this.authService.getCorrelationId()];case 3:return g[f]=e.sent(),[3,5];case 4:return v=e.sent(),this.logService.log_e(v),[3,5];case 5:w=Oe+"/gateways/control",y={headers:d},e.label=6;case 6:return e.trys.push([6,8,,9]),[4,this.webService.postApi(w,h,y,i).toPromise()];case 7:return b=e.sent(),this.remoteOnline=!0,this.completedFirstRun=!0,[2,b];case 8:return m=e.sent(),this.logService.log_e("gatewayservice::callApi: Network error remote request"+JSON.stringify(m)),this.remoteOnline=!1,[3,9];case 9:return[3,29];case 10:if("local"!==U&&"admin"!==U)return[3,18];this.logService.log("Connection is local"),S="Basic "+btoa(o+":"+a),e.label=11;case 11:return e.trys.push([11,13,,17]),I={headers:{Authorization:S}},"GET"!==x.toUpperCase()&&"OPTIONS"!==x.toUpperCase()&&(I.body=N),I.responseType=q,w="http://"+j.localIp+":8083/"+P,[4,this.webService.requestApi(x,w,I,i).toPromise()];case 12:return b=e.sent(),this.localOnline=!0,this.completedFirstRun=!0,[2,b];case 13:return T=e.sent(),this.logService.log_e("gatewayservice::callApi: Network error local request"+JSON.stringify(T)),this.localOnline=!1,U?[3,15]:[4,this.callApi(j,P,x,N,M,"remote")];case 14:return[2,e.sent()];case 15:throw T;case 16:return[3,17];case 17:return[3,29];case 18:if(U)return[3,29];(new Date).getTime(),_={"continue":!0},E={"continue":!0},A=this.callApi(j,P,x,N,M,"remote",undefined,undefined,E),L=this.callApi(j,P,x,N,M,"local",undefined,undefined,_),e.label=19;case 19:return e.trys.push([19,21,,29]),[4,Promise.race([A,L])];case 20:return R=e.sent(),_["continue"]=!1,E["continue"]=!1,[2,R];case 21:k=e.sent(),this.logService.log_e("gatewayservice::callApi: parallel promise failed "+k),O=void 0,e.label=22;case 22:return e.trys.push([22,24,,25]),[4,A];case 23:return O=e.sent(),this.remoteOnline=!0,[3,25];case 24:return C=e.sent(),this.remoteOnline=!1,this.logService.log_e("gatewayservice::callApi: remote request failed with error "+JSON.stringify(C)),[3,25];case 25:return e.trys.push([25,27,,28]),[4,L];case 26:return O=e.sent(),this.localOnline=!0,[3,28];case 27:return D=e.sent(),this.localOnline=!1,this.logService.log_e("gatewayservice::callApi: Local request failed with error "+JSON.stringify(D)),[3,28];case 28:if(O===undefined)throw new Error("gatewayservice::callApi: Both requests failed");return[2,O];case 29:return[2]}})})},Fe.prototype.getLeckageDeviceConnectedToGateway=function(o,e,a){return void 0===e&&(e=!1),void 0===a&&(a=!1),E(this,void 0,void 0,function(){var t,r,n,i;return X(this,function(e){switch(e.label){case 0:return a?[4,this.callApi(o,"ZWaveAPI/Data","get",null,null,null)]:[3,2];case 1:return t=e.sent(),[3,4];case 2:return[4,this.callApi(o,"ZWaveAPI/Data","get",null,null,null,1,1)];case 3:t=e.sent(),e.label=4;case 4:for(n in r=[],this.logService.log("gatewayService::got devices: "+JSON.stringify(t)),t.devices)(i=t.devices[n]).data.manufacturerId.value===_e&&i.data.manufacturerProductId.value===Ee&&i.data.manufacturerProductType.value===Ae&&r.push({nodeId:n,givenName:i.data.givenName.value});return[2,r]}})})},Fe.prototype.onLogout=function(){return E(this,void 0,void 0,function(){return X(this,function(e){return[2]})})},Fe.prototype.saveGateway=function(t,r){return E(this,void 0,void 0,function(){return X(this,function(e){return this.logService.log(t),this.cacheService.setLocalData(this.storageName,JSON.stringify(r)),[2]})})},Fe.prototype.getPairedGateway=function(r){return E(this,void 0,void 0,function(){var t;return X(this,function(e){return this.logService.log("in get pair getway service",r),t=JSON.stringify(this.cacheService.getLocalData(this.storageName)),this.logService.log(t),[2,JSON.parse(t)]})})},Fe.INIT_INTERVAL_REMOTE=2e3,Fe.MAX_INTERVAL_REMOTE=6e3,Fe.REQ_TIMEOUT_REMOTE=2e4,Fe.INIT_INTERVAL_LOCAL=2e3,Fe.MAX_INTERVAL_LOCAL=6e3,Fe.REQ_TIMEOUT_LOCAL=6e3,Fe.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],Fe.ctorParameters=function(){return[{type:g.HttpClient},{type:xe},{type:he},{type:ee},{type:oe},{type:R}]},Fe.ngInjectableDef=v.defineInjectable({factory:function(){return new Fe(v.inject(g.HttpClient),v.inject(xe),v.inject(he),v.inject(ee),v.inject(oe),v.inject(R))},token:Fe,providedIn:"root"}),Fe);function Fe(e,t,r,n,i,o){this.http=e,this.gatewayAclService=t,this.authService=r,this.cacheService=n,this.webService=i,this.logService=o,this.observerId=48976446132111,this.completedFirstRun=!1,this.storageName="gateway_device"}var $e=(Be.prototype.updateGatewayData=function(c,l,u){return E(this,void 0,void 0,function(){var t,r,n,i,o,a,s;return X(this,function(e){switch(e.label){case 0:return t={},r=g.HttpHeaders.bind,n={"Content-Type":"application/json",access_token:u},i="x-correlation-id",[4,this.authService.getCorrelationId()];case 1:return t.headers=new(r.apply(g.HttpHeaders,[void 0,(n[i]=e.sent(),n)])),o=Oe+"/gateways/"+l,a={REQ_TIMEOUT:Be.REQ_TIMEOUT,INIT_INTERVAL:Be.INIT_INTERVAL,MAX_INTERVAL:Be.MAX_INTERVAL,MAX_RETRIES:Be.MAX_RETRIES},[4,this.webService.getApi(o,t,a).toPromise()];case 2:if(!((s=e.sent()).boxId&&s.homeGwId&&s.homeId&&s.id&&s.localIp))throw new Error("Could not fetch Gateway, empty response!");return c.boxId=s.boxId,c.homeGwId=s.homeGwId,c.homeId=s.homeId,c.id=s.id,c.localIp=s.localIp,[2]}})})},Be.INIT_INTERVAL=2e3,Be.MAX_INTERVAL=6e3,Be.MAX_RETRIES=3,Be.REQ_TIMEOUT=6e3,Be.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],Be.ctorParameters=function(){return[{type:he},{type:oe}]},Be.ngInjectableDef=v.defineInjectable({factory:function(){return new Be(v.inject(he),v.inject(oe))},token:Be,providedIn:"root"}),Be);function Be(e,t){this.authService=e,this.webService=t}var ze=new f.Subject,Je=(Qe.prototype.initialize=function(){return E(this,void 0,void 0,function(){var t=this;return X(this,function(e){return this.logService.log("onlineOffline::initialize"),clearInterval(this.tickInterval),this.tickInterval=setInterval(function(){t.tick()},this.refreshTime),[2]})})},Qe.prototype.tick=function(){return E(this,void 0,void 0,function(){var t,r;return X(this,function(e){switch(e.label){case 0:return this.logService.log("onlineOffline::tick"),t=this.localOnline,r=this.remoteOnline,[4,this.checkConnection("local")];case 1:return e.sent(),[4,this.checkConnection("remote")];case 2:return e.sent(),t===this.localOnline&&r===this.remoteOnline||this.notify(),[2]}})})},Qe.prototype.notify=function(){this.logService.log("onlineOffline::notify"),ze.next({localOnline:this.localOnline,remoteOnline:this.remoteOnline})},Qe.prototype.checkConnection=function(i){return E(this,void 0,void 0,function(){var t,r,n;return X(this,function(e){switch(e.label){case 0:return[4,this.authService.getUser()];case 1:return t=e.sent(),[4,this.gatewayService.getPairedGateway(t.access_token)];case 2:r=e.sent(),e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.gatewayService.callApi(r,"ZAutomation/api/v1/status","get",null,null,i)];case 4:return(n=e.sent())!==undefined&&200===n.code?"local"===i?this.localOnline=!0:this.remoteOnline=!0:(this.logService.log("onlineOffline::local offline-- "+JSON.stringify(n)),"local"===i?this.localOnline=!1:this.remoteOnline=!1),[3,6];case 5:return e.sent(),this.logService.log("onlineOffline::local offline catch"),"local"===i?this.localOnline=!1:this.remoteOnline=!1,[3,6];case 6:return[2]}})})},Qe.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],Qe.ctorParameters=function(){return[{type:he},{type:He},{type:R}]},Qe.ngInjectableDef=v.defineInjectable({factory:function(){return new Qe(v.inject(he),v.inject(He),v.inject(R))},token:Qe,providedIn:"root"}),Qe);function Qe(e,t,r){this.authService=e,this.gatewayService=t,this.logService=r,this.refreshTime=5e3,this.failureRate=new f.BehaviorSubject(0),this.REGUARD_OFFLINE=!1,this.remoteOnline=!0,this.localOnline=!0,this.logService.log("onlineOffline::onInit")}var We="L/M",Ze="L/H",Ke="m3/H",Ye="l",et="m3",tt="C",rt="F",nt="Bar",it="Pa",ot=function gt(){this.amountUnit=Ye,this.flowUnit=Ze,this.pressureUnit=nt,this.temperatureUnit=tt},at=(st.prototype.convertAmount=function(e,t){return console.log("Hy I am Unit",e),e!==Ye&&e===et?this.roundValue(t):this.roundValueToZeroDigits(1e3*t)},st.prototype.convertFlow=function(e,t){return e===We?this.roundValue(t/60):e===Ze?this.roundValueToZeroDigits(t):e===Ke?this.roundValue(t/1e3):this.roundValue(t/60)},st.prototype.convertTemp=function(e,t){return e!==tt&&e===rt?this.roundValue(9*t/5+32):this.roundValue(t)},st.prototype.convertPressure=function(e,t){return e!==nt&&e===it?this.roundValue(t):this.roundValue(t/100)},st.prototype.getSettings=function(){return E(this,void 0,void 0,function(){var t,r;return X(this,function(e){return t=new ot,null!==(r=this.cacheService.getLocalData(this.storageName))&&(t=r),null==t&&(console.log("GW was null, create new object"),t=new ot),[2,t]})})},st.prototype.setSettings=function(t){return E(this,void 0,void 0,function(){return X(this,function(e){return this.cacheService.setLocalData(this.storageName,t),[2]})})},st.prototype.roundValue=function(e){return e.toFixed(1)},st.prototype.roundValueToZeroDigits=function(e){return e.toFixed(0)},st.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],st.ctorParameters=function(){return[{type:ee}]},st.ngInjectableDef=v.defineInjectable({factory:function(){return new st(v.inject(ee))},token:st,providedIn:"root"}),st);function st(e){this.cacheService=e,this.storageName="user_settings"}var ct=(lt.prototype.getAllConfigParams=function(){return E(this,void 0,void 0,function(){return X(this,function(e){return[2,1]})})},lt);function lt(){this.sensorDevices=[]}var ut=new f.Subject,ht=new f.Subject,pt=(Object.defineProperty(dt.prototype,"deviceMap",{get:function(){return this._deviceMap},set:function(e){this._deviceMap=e,this.setConfigWrapperToStorage(e)},enumerable:!0,configurable:!0}),dt.prototype.onlineOfflineUpdate=function(e,t){this.logService.log("zAutomationAPI::onlineOfflineUpdate "+e+" "+t),this.remoteOnline=t,this.localOnline=e},dt.prototype.initialize=function(){var e=this;this.logService.log("initialize method call-- in zAutomation service"),clearInterval(this.tickInterval),this.onlineOfflineService.initialize(),this.tick(!0),this.logService.log("Tick Runs 1st Time -------------------\x3e"),this.tickInterval=setInterval(function(){return E(e,void 0,void 0,function(){return X(this,function(e){return this.tick(!1),[2]})})},this.refreshTime)},dt.prototype.tick=function(i){return E(this,void 0,void 0,function(){var t,r,n;return X(this,function(e){switch(e.label){case 0:this.logService.log("in tick function zAutomation service"),this.logService.log("zAutomationAPI::tick"),e.label=1;case 1:return e.trys.push([1,10,,11]),this.localOnline||this.remoteOnline?[4,this.authService.getUser()]:(this.logService.log("zAutomationAPI::no tick, because Offline"),[2]);case 2:return t=e.sent(),[4,this.gatewayService.getPairedGateway(t.access_token)];case 3:return e.sent().leckageDeviceId===undefined?[3,8]:i?(this.logService.log("zAutomationAPI::firstRunLoad"),[4,(r=this).getConfigWrapperFromStorage()]):[3,5];case 4:return r._deviceMap=e.sent(),this.notify(),[3,7];case 5:return this.logService.log("zAutomationAPI::tick::polldata"),this.logService.log("DEBUG firstrun:"+i),[4,this.pollData()];case 6:e.sent(),e.label=7;case 7:return this.decFailureRate(),[3,9];case 8:this.logService.log("zAutomationAPI::tick: leackage device undefined, skipping network requests"),e.label=9;case 9:return[3,11];case 10:return n=e.sent(),this.logService.log("zAutomationAPI::tick:Catch: Could not get tick, error: "+n.message+";;;;;;;"+n.stack),this.incFailureRate(),[3,11];case 11:return[2]}})})},dt.prototype.pollData=function(){return E(this,void 0,void 0,function(){return X(this,function(e){switch(e.label){case 0:return this.deviceMap&&this.deviceMap.updateTime&&0<Object.keys(this.deviceMap.devices).length?(this.logService.log("zAutomationAPI::pollData: Polling delta data"),[4,this.fetchPollData("delta")]):[3,2];case 1:return e.sent(),[3,4];case 2:return this.logService.log("zAutomationAPI::pollData: Polling complete data"),[4,this.fetchPollData("complete")];case 3:e.sent(),e.label=4;case 4:return[2]}})})},dt.prototype.fetchPollData=function(u){return E(this,void 0,void 0,function(){var t,r,n,i,o,a,s,c,l;return X(this,function(e){switch(e.label){case 0:return this.logService.log("in fetchPollData method"),t="delta"===u?"ZAutomation/api/v1/devices?since="+this.deviceMap.updateTime:"ZAutomation/api/v1/devices",r={updateTime:"",devices:null},this.logService.log("zAutomationAPI::pollCompleteData"),[4,this.authService.getUser()];case 1:return n=e.sent(),[4,this.gatewayService.getPairedGateway(n.access_token)];case 2:return i=e.sent(),[4,this.gatewayService.callApi(i,t)];case 3:return o=e.sent(),this.logService.log("I am PollObject, I might have all the Device Data",o),"delta"!==u?[3,5]:(r.updateTime=o.data.updateTime,a=r,[4,this.parseDevices(o.data.devices)]);case 4:if(a.devices=e.sent(),r&&r.devices){for(c in s=!1,r.devices)this._deviceMap.devices[c]=r.devices[c],s=!0;s&&(this.setConfigWrapperToStorage(this._deviceMap),this.notify())}return[3,7];case 5:return r.updateTime=o.data.updateTime,l=r,[4,this.parseDevices(o.data.devices)];case 6:l.devices=e.sent(),this.deviceMap=r,this.notify(),e.label=7;case 7:return[2]}})})},dt.prototype.getDeviceAndInstance=function(t){return E(this,void 0,void 0,function(){return X(this,function(e){return[2,{device:t.leckageDeviceId,instance:0}]})})},dt.prototype.parseDevices=function(h){return E(this,void 0,void 0,function(){var r,n,i,o,a,s,c,l,u;return X(this,function(e){switch(e.label){case 0:return[4,this.authService.getUser()];case 1:return i=e.sent(),[4,this.gatewayService.getPairedGateway(i.access_token)];case 2:return o=e.sent(),[4,this.getDeviceAndInstance(o)];case 3:a=e.sent(),s={};try{for(c=G(h),l=c.next();!l.done;l=c.next())((u=l.value)&&u.nodeId&&u.nodeId.toString()===a.device.toString()||"DummyDevice_18"===u.id)&&(s[u.id]=u)}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=c["return"])&&n.call(c)}finally{if(r)throw r.error}}return[2,s]}})})},dt.prototype.getConfigWrapperFromStorage=function(){return E(this,void 0,void 0,function(){return X(this,function(e){return[2,this.cacheService.getLocalData(this.storageName)]})})},dt.prototype.setConfigWrapperToStorage=function(t){return E(this,void 0,void 0,function(){return X(this,function(e){return this.cacheService.setLocalData(this.storageName,t),[2]})})},dt.prototype.notify=function(){ut.next({flag:!0})},dt.prototype.filterDeviceMap=function(e){for(var t in this.deviceMap.devices)if(e.test(t))return this.deviceMap.devices[t]},dt.prototype.incFailureRate=function(){this.failureRate.getValue()<3&&this.failureRate.next(this.failureRate.getValue()+1)},dt.prototype.decFailureRate=function(){0<this.failureRate.getValue()&&this.failureRate.next(this.failureRate.getValue()-1)},dt.prototype.updateSensorValue=function(a){return E(this,void 0,void 0,function(){var t,r,n,i,o;return X(this,function(e){switch(e.label){case 0:return this.logService.log("in updateSensorValue--\x3e",a),[4,this.authService.getUser()];case 1:return t=e.sent(),[4,this.gatewayService.getPairedGateway(t.access_token)];case 2:return r=e.sent(),[4,this.getDeviceAndInstance(r)];case 3:switch(n=e.sent(),i="ZWayVDev_zway_"+n.device+"-"+n.instance,o="",a){case 0:o=i+"-50-0";break;case 1:o=i+"-49-23";break;case 2:o=i+"-49-56";break;case 3:o=i+"-49-57"}return this.logService.log("call api ---\x3esensorPath",o),[4,this.gatewayService.callApi(r,"ZAutomation/api/v1/devices/"+o+"/command/update")];case 4:return e.sent(),[2]}})})},dt.prototype.getSensorValue=function(v){return E(this,void 0,void 0,function(){var t,r,n,i,o,a,s,c,l,u,h,p,d,g,f=this;return X(this,function(e){switch(e.label){case 0:return t=v,this.logService.log("in update method-- device metrics"),[4,this.authService.getUser()];case 1:return r=e.sent(),[4,this.gatewayService.getPairedGateway(r.access_token)];case 2:if(n=e.sent(),!this.deviceMap||!this.deviceMap.updateTime)return[3,7];if(this.device?this.device.sensorDevices=[]:this.device=new ct,this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-37$","g")).metrics.isFailed)return setTimeout(function(){f.getSensorValue(t)},5e3),[2];e.label=3;case 3:return e.trys.push([3,5,,6]),[4,this.settingService.getSettings()];case 4:for(i=e.sent(),o=this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-50-0$","g")),this.logService.log("DeviceMetricsComponent::Update: settings meter before converting: "+JSON.stringify(o.metrics.level)),t[0].timestamp=o.updateTime,t[0].value=""+this.settingService.convertAmount(i.amountUnit,o.metrics.level),a=this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-49-23$","g")),t[1].timestamp=a.updateTime,t[1].value=""+this.settingService.convertTemp(i.temperatureUnit,a.metrics.level),s=this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-49-56$","g")),t[2].timestamp=s.updateTime,t[2].value=""+this.settingService.convertFlow(i.flowUnit,s.metrics.level),c=this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-49-57$","g")),this.logService.log("DeviceMetricsComponent::Update: settings waterPressure: "+JSON.stringify(c)),this.logService.log("Water Sensor Updated Time",c.updateTime),t[3].timestamp=c.updateTime,t[3].value=""+this.settingService.convertPressure(i.pressureUnit,c.metrics.level),(l=this.filterDeviceMap(new RegExp("DummyDevice_18","g")))&&(this.logService.log("Dummy Device Updated level",l.metrics.level),t[4].timestamp=l.updateTime,t[4].value=l.metrics.level),this.logService.log("Hey I am New Sensor Value",t),this.cacheService.setLocalData("sensors",t),this.logService.log("sensors-local-storage: "+JSON.stringify(t)),u=Math.floor((new Date).getTime()/1e3)-120,h=Math.floor((new Date).getTime()/1e3)-20,this.logService.log("before loop sensor---\x3e",t),p=0;p<t.length;p++)this.logService.log("DeviceMetricsComponent::Update: oldstamp: "+t[p].timestamp+"newstamp: "+u),t[p].timestamp&&t[p].timestamp<u&&this.appStartTime<h&&(this.updateSensorValue(p),this.logService.log("DeviceMetricsComponent::Update: UpdateSensorValueCalled "+(u-t[p].timestamp)));return[3,6];case 5:return d=e.sent(),this.logService.log("DeviceMetricsComponent::Update: Error fetching deviceMetrics! "+d),[3,6];case 6:this.freezeButtonUntil<=(new Date).getTime()&&(g=this.filterDeviceMap(new RegExp(n.leckageDeviceId+"-[0-9]*-37$","g")),this.safeGuardChecked.flag="on"===g.metrics.level,this.cacheService.setLocalData("safeGuardChecked",this.safeGuardChecked)),e.label=7;case 7:return ht.next({data:t}),[2]}})})},dt.decorators=[{type:v.Injectable,args:[{providedIn:"root"}]}],dt.ctorParameters=function(){return[{type:Je},{type:he},{type:He},{type:at},{type:R},{type:ee}]},dt.ngInjectableDef=v.defineInjectable({factory:function(){return new dt(v.inject(Je),v.inject(he),v.inject(He),v.inject(at),v.inject(R),v.inject(ee))},token:dt,providedIn:"root"}),dt);function dt(e,t,r,n,i,o){var a=this;this.onlineOfflineService=e,this.authService=t,this.gatewayService=r,this.settingService=n,this.logService=i,this.cacheService=o,this.appStartTime=Math.floor((new Date).getTime()/1e3),this.storageName="zautomation_object",this.remoteOnline=!0,this.localOnline=!0,this.refreshTime=2500,this.freezeButtonUntil=0,this.safeGuardChecked={flag:!1},this.failureRate=new f.BehaviorSubject(0),this.logService.log("zAutomationAPI::onInit"),this.cacheService.getLocalData("safeGuardChecked")&&(this.safeGuardChecked=this.cacheService.getLocalData("safeGuardChecked")),ze.subscribe(function(e){a.onlineOfflineUpdate(e.localOnline,e.remoteOnline)})}e.RehauFunctionalCoreService=S,e.RehauFunctionalCoreModule=U,e.reducers=Y,e.CacheService=ee,e.LogService=R,e.LoginService=ye,e.AuthService=he,e.LoaderFlag=ce,e.StoreService=le,e.TranslationService=N,e.AuthGuard=Se,e.slideInAnimation=we,e.OnBoardingService=be,e.GatewayAlreadyConfiguredError=Ue,e.GatewaySerialNotFoundError=Xe,e.GatewayService=He,e.GatewayAclService=xe,e.GatewayDeviceControlService=$e,e.sensorUpdateSub=ut,e.sensorsDataSub=ht,e.ZAutomationService=pt,e.ɵe=O,e.ɵd=w,e.ɵs=at,e.ɵr=Je,e.ɵa=D,e.ɵb=j,e.ɵc=P,e.ɵq=oe,e.ɵm=$,e.ɵl=J,e.ɵk=B,e.ɵp=Q,e.ɵn=W,e.ɵo=K,e.ɵj=m,e.ɵi=y,e.ɵg=q,e.ɵh=F,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=rehau-functional-core.umd.min.js.map